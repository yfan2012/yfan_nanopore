library(ggplot2)
library(tidyverse)

datadir='/uru/Data/dunlop/'
prefix='190918_dunlop'
dbxdir=paste0('~/Dropbox/yfan/dunlop/',prefix,'/')

varsdir=paste0(datadir,prefix,'/vars')
varfiles=list.files(varsdir, 'csv')

##read in all the vars data
vars=read_csv(paste0(varsdir, '/', varfiles[1]), col_names=c('chr', 'pos','ref', 'alt', 'numref', 'numalt', 'gene', 'prod')) %>%
    mutate(prefix=basename(varfiles[1]))
for (i in varfiles[-1]) {
    tmpvars=read_csv(paste0(varsdir, '/', i), col_names=c('chr', 'pos','ref', 'alt', 'numref', 'numalt', 'gene', 'prod')) %>%
        mutate(prefix=basename(i))
    vars=rbind(vars, tmpvars)
}
vars=vars %>%
    mutate(perc=numalt/(numref+numalt))

##report all vars with more than 3 reads supporting it
highev=vars[vars$numalt>3,] %>%
    arrange(desc(pos)) %>%
    filter(gene!='unk')
write.table(data.frame(highev), paste0(dbxdir, 'filtered_muts.csv'), sep=',')



