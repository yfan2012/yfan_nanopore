library(ggplot2)
library(tidyverse)
library(R.utils)

##read in cov files, basic cov plot
##samps=c('infected', 'mock', 'antibody')
##datadir='/scratch/groups/mschatz1/cpowgs/sindbis'
samps=c('Antibody_2dpi', 'Antibody_3dpi', 'Sindbis_2dpi', 'Sindbis_3dpi')
datadir='/dilithium/Data/Nanopore/sindbis'
outdir='~/Dropbox/Timplab_Data/sindbis'

allcov=NULL

for (samp in samps) {
    covfile=paste0(datadir, '/',samp, '/cov/', samp, '.primary.cov') 
    fqfile=paste0(datadir, '/', samp, '/fqs/', samp, '.fq')
    numreads=countLines(fqfile)[[1]]/4
    
    cov=read_tsv(covfile, col_names=c('chr', 'pos', 'cov')) %>%
        mutate(sample=samp) %>%
        mutate(normcov=cov/numreads)
    
    allcov=bind_rows(allcov, cov)
    
    xwidth=max(cov$pos)-min(cov$pos)
    yheight=max(cov$cov)
    
    pdf(paste0(outdir,'/', samp, '/cov/', samp, '.primary.cov.pdf'), width=20, height=5)
    print(ggplot(cov, aes(x=pos, y=normcov)) +
        geom_line() +
        xlab('Sindbis Genome Position') +
        ylab('Depth') +
        ggtitle(paste0(samp, ' Coverage')) +
        theme_bw())
    dev.off()
}


pdf(paste0(outdir,'/allcov.primary.normcov.v2.pdf'), width=20, height=5)
print(ggplot(allcov, aes(x=pos, y=normcov, colour=sample)) +
      geom_line() +
      xlab('Sindbis Genome Position') +
      ylab('Depth') +
      ggtitle(paste0('Coverage')) +
      theme_bw())
dev.off()
